<%- include('layout/adminheader.ejs') %>
<link
  rel="stylesheet"
  href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css"
/>
<link
  rel="stylesheet"
  href="https://cdn.datatables.net/buttons/2.0.1/css/buttons.dataTables.min.css"
/>

<script
  type="text/javascript"
  language="javascript"
  src="https://code.jquery.com/jquery-3.5.1.js"
></script>
<script
  type="text/javascript"
  language="javascript"
  src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"
></script>
<script
  type="text/javascript"
  language="javascript"
  src="https://cdn.datatables.net/buttons/2.0.1/js/dataTables.buttons.min.js"
></script>
<script
  type="text/javascript"
  language="javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"
></script>
<script
  type="text/javascript"
  language="javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"
></script>
<script
  type="text/javascript"
  language="javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"
></script>
<script
  type="text/javascript"
  language="javascript"
  src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.html5.min.js"
></script>

<div class="app-wrapper">
  <div class="app-content pt-3 p-md-3 p-lg-4">
    <div class="container-xl">
      <div class="container px-6 mx-auto grid">
        <h2
          class="my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200"
        >
          Sales Report
        </h2>
      </div>
      <div style="width: 25%">
        <div class="p-3">
          <div class="col-md-10" id="from">
            <label for="">Search From</label>
            <input
              class="form-control"
              type="date"
              value=""
              id="datefrom"
              style="width: 150px"
            />
          </div>
          <div class="col-md-10" id="to">
            <label for="">Search To</label>
            <input
              class="form-control"
              type="date"
              value=""
              id="dateto"
              style="width: 150px"
            />
          </div>
          <button class="btn-primary btn-sm mt-2" onclick="findByDate()">
            Apply
          </button>
        </div>
      </div>
      <div class="tab-content" id="orders-table-tab-content">
        <div
          class="tab-pane fade show active"
          id="orders-all"
          role="tabpanel"
          aria-labelledby="orders-all-tab"
        >
          <div class="app-card app-card-orders-table shadow-sm mb-5">
            <div class="app-card-body">
              <div class="table-responsive">
                <table
                  id="example"
                  class="items-center justify-center w-full mb-0 ml-5 align-top border-collapse dark:border-white/40 text-slate-500 display nowrap"
                  style="width: 95%; padding-bottom: 25vh"
                >
                  <thead class="align-bottom">
                    <tr>
                      <th
                        class="px-6 py-3 font-semibold capitalize align-middle bg-transparent border-b border-solid shadow-none dark:border-white/40 dark:text-white tracking-none whitespace-nowrap"
                      >
                        Date
                      </th>
                      <th
                        class="px-6 py-3 font-semibold capitalize align-middle bg-transparent border-b border-solid shadow-none dark:border-white/40 dark:text-white tracking-none whitespace-nowrap"
                      >
                        Total Price
                      </th>
                      <th
                        class="px-6 py-3 font-semibold capitalize align-middle bg-transparent border-b border-solid shadow-none dark:border-white/40 dark:text-white tracking-none whitespace-nowrap"
                      >
                        Profit
                      </th>
                      <th
                        class="px-6 py-3 font-semibold capitalize align-middle bg-transparent border-b border-solid shadow-none dark:border-white/40 dark:text-white tracking-none whitespace-nowrap"
                      >
                        Order Count
                      </th>
                    </tr>
                  </thead>
                  <tbody class="border-t" id="byDate">
                    <% saleReport.forEach(report=> { %>
                    <tr>
                      <td
                        class="p-2 align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent"
                      >
                        <h6 class="mb-0 text-sm leading-normal dark:text-white">
                          <%= report._id %>
                        </h6>
                      </td>
                      <td
                        class="p-2 align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent"
                      >
                        <p
                          class="mb-0 text-sm font-semibold leading-normal dark:text-white dark:opacity-60"
                        >
                          <%= report.totalPrice %>
                        </p>
                      </td>
                      <td
                        class="p-2 align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent"
                      >
                        <p
                          class="mb-0 text-sm font-semibold leading-normal dark:text-white dark:opacity-60"
                        >
                          ₹ <%=parseFloat(report.totalPrice*25/100).toFixed(1)%>
                        </p>
                      </td>
                      <td
                        class="p-2 align-middle border-b whitespace-nowrap shadow-transparent"
                      >
                        <span
                          class="text-xs font-semibold dark:text-white dark:opacity-60"
                        >
                          <%= report.count %>
                        </span>
                      </td>
                    </tr>
                    <% }) %>
                  </tbody>
                </table>
              </div>
              <!--//table-responsive-->
            </div>
            <!--//app-card-body-->
          </div>
          <!--//app-card-->
        </div>
        <!--//tab-pane-->

        <!--//tab-pane-->
      </div>
      <!--//tab-content-->
    </div>
    <!--//container-fluid-->
  </div>
  <!--//app-content-->
</div>
<!--//app-wrapper-->
<!-- Javascript -->
<script src="assets/plugins/popper.min.js"></script>
<script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>

<!-- Page Specific JS -->
<script src="assets/js/app.js"></script>

<script>
  $(document).ready(function () {
    $("#example").DataTable({
      dom: "Bfrtip",
      buttons: ["copy", "csv", "excel", "pdf", "print"],
    });
  });

  function findByDate() {
    const toDate = document.getElementById("dateto").value;
    const fromDate = document.getElementById("datefrom").value;
    alert(toDate);
    alert(fromDate);
    axios
      .get("/admin/salesreportbysearch", {
        params: {
          toDate,
          fromDate,
        },
      })
      .then((e) => {
        if (e.data) {
          let report = e.data.saleReport;
          console.log(report);
          let html = "";
          for (let i = 0; i < report.length; i++) {
            html += `<tr>
                      <td
                        class="p-2 align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent"
                      >
                        <h6 class="mb-0 text-sm leading-normal dark:text-white">
                          ${report[i]._id} 
                        </h6>
                      </td>
                      <td
                        class="p-2 align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent"
                      >
                        <p
                          class="mb-0 text-sm font-semibold leading-normal dark:text-white dark:opacity-60"
                        >
                          ${report[i].totalPrice} 
                        </p>
                      </td>
                      <td
                        class="p-2 align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent"
                      >
                        <p
                          class="mb-0 text-sm font-semibold leading-normal dark:text-white dark:opacity-60"
                        >
                          ₹ ${parseFloat(
                            (report[i].totalPrice * 25) / 100
                          ).toFixed(1)}
                        </p>
                      </td>
                      <td
                        class="p-2 align-middle border-b whitespace-nowrap shadow-transparent"
                      >
                        <span
                          class="text-xs font-semibold dark:text-white dark:opacity-60"
                        >
                          ${report[i].count} 
                        </span>
                      </td>
                    </tr>`;
          }
          document.getElementById("byDate").innerHTML = html;
        }
      });
  }
</script>
<%- include('layout/admin-footer.ejs') %>
